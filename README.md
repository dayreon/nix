# NixOS Configuration

–Å-–º–æ—ë, –∫–∞–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è! –ü–æ–≥–Ω–∞–ª–∏ —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥–∞

```
.
‚îú‚îÄ‚îÄ flake.nix           # –ì–ª–∞–≤–Ω—ã–π —Ñ–ª–µ–π–∫, —Ç—É—Ç –≤—Å—è –º–∞–≥–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è
‚îú‚îÄ‚îÄ hosts/
‚îÇ   ‚îî‚îÄ‚îÄ emerald/        # –ö–æ–Ω—Ñ–∏–≥ –¥–ª—è –Ω–∞—à–µ–≥–æ –∫—Ä–∞—Å–∞–≤—Ü–∞-–∫–æ–º–ø–∞
‚îÇ       ‚îú‚îÄ‚îÄ default.nix    # –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ       ‚îî‚îÄ‚îÄ hardware.nix   # –ñ–µ–ª–µ–∑—è—á–Ω—ã–µ –¥–µ–ª–∞
‚îî‚îÄ‚îÄ modules/
    ‚îú‚îÄ‚îÄ desktop/        # –í—Å—ë –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞
    ‚îÇ   ‚îú‚îÄ‚îÄ default.nix    # –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ—Å–∫—Ç–æ–ø–∞
    ‚îÇ   ‚îú‚îÄ‚îÄ fonts.nix      # –®—Ä–∏—Ñ—Ç—ã —á—Ç–æ–± –≥–ª–∞–∑–∞ —Ä–∞–¥–æ–≤–∞–ª–∏—Å—å
    ‚îÇ   ‚îî‚îÄ‚îÄ hyprland.nix   # Hyprland - –Ω–∞—à –ª—é–±–∏–º—ã–π WM
    ‚îú‚îÄ‚îÄ system/         # –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    ‚îÇ   ‚îú‚îÄ‚îÄ default.nix    # –ë–∞–∑–æ–≤—ã–µ —à—Ç—É–∫–∏
    ‚îÇ   ‚îú‚îÄ‚îÄ btrfs.nix      # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ BTRFS –∏ —Å–Ω–∞–ø—à–æ—Ç–æ–≤
    ‚îÇ   ‚îú‚îÄ‚îÄ nixos-snapshots.nix # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–Ω–∞–ø—à–æ—Ç–æ–≤ —Å NixOS
    ‚îÇ   ‚îî‚îÄ‚îÄ locale.nix     # –õ–æ–∫–∞–ª–∏ –∏ —á–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞
    ‚îî‚îÄ‚îÄ users/          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —é–∑–µ—Ä–æ–≤
        ‚îú‚îÄ‚îÄ default.nix    # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        ‚îú‚îÄ‚îÄ home.nix       # Home Manager –∫–æ–Ω—Ñ–∏–≥
        ‚îî‚îÄ‚îÄ programs/      # –ö–æ–Ω—Ñ–∏–≥–∏ –ø—Ä–æ–≥—Ä–∞–º–º
            ‚îú‚îÄ‚îÄ nushell.nix   # –ù–∞—à —Ç–æ–ø–æ–≤—ã–π —à–µ–ª–ª
            ‚îú‚îÄ‚îÄ starship.nix  # –ö—Ä–∞—Å–∏–≤—ã–π –ø—Ä–æ–º–ø—Ç
            ‚îî‚îÄ‚îÄ zed.nix       # –†–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è –∫—Ä—É—Ç—ã—Ö
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ì—Ä—É–∑–∏–º—Å—è —Å NixOS minimal ISO
```bash
curl -f https://raw.githubusercontent.com/decard2/nix/main/install.sh | sudo sh
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ BTRFS

–£ –Ω–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∞–±–≤–æ–ª—é–º–æ–≤:
- `@` - –∫–æ—Ä–Ω–µ–≤–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
- `@home` - –¥–æ–º–∞—à–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `@nix` - nixos store
- `@cache` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –∫—ç—à–∏
- `@log` - —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–∞–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
- –°–Ω–∞–ø—à–æ—Ç—ã –Ω–µ –≤–∫–ª—é—á–∞—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- –ú–æ–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞
- –õ–µ–≥–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏
sudo nixos-safe-rebuild

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—è –∞–ª–∏–∞—Å
nsr
```

### –û—Ç–∫–∞—Ç —Å–∏—Å—Ç–µ–º—ã
```bash
# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
sudo nixos-rollback

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—è –∞–ª–∏–∞—Å
nrb
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å–Ω–∞–ø—à–æ—Ç—ã
snapper list
# –∏–ª–∏
nls

# –°—Ä–∞–≤–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ–∂–¥—É —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏
snapper diff NUMBER1..NUMBER2
# –∏–ª–∏
ndf NUMBER1..NUMBER2
```

### –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
sudo nixos-clean-temp

# –°–¥–µ–ª–∞—Ç—å —Ä—É—á–Ω–æ–π —Å–Ω–∞–ø—à–æ—Ç
sudo nixos-snapshot pre "–û–ø–∏—Å–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ BTRFS
sudo btrfs scrub start /
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∞–ª–∏–∞—Å—ã

–í nushell –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∞–ª–∏–∞—Å—ã:

### –û–±—â–∏–µ
- `ll` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
- `g` - —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –¥–ª—è git
- `update` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –°–Ω–∞–ø—à–æ—Ç—ã –∏ —Å–∏—Å—Ç–µ–º–∞
- `nsr` - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–Ω–∞–ø—à–æ—Ç–æ–≤
- `nrb` - –æ—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
- `nls` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–Ω–∞–ø—à–æ—Ç–æ–≤
- `ndf` - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–æ–≤

## BTRFS —Ñ–∏—à–∫–∏

### –°–Ω–∞–ø—à–æ—Ç—ã
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–Ω–∞–ø—à–æ—Ç –∫–æ—Ä–Ω–µ–≤–æ–π –§–° (—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è)
sudo btrfs subvolume snapshot -r / /.snapshots/root-$(date +%F)

# –°–æ–∑–¥–∞—Ç—å —Å–Ω–∞–ø—à–æ—Ç –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo btrfs subvolume snapshot -r /home /.snapshots/home-$(date +%F)

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ —Å–∞–±–≤–æ–ª—é–º–æ–≤
sudo btrfs subvolume list /

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π —Å–Ω–∞–ø—à–æ—Ç
sudo btrfs subvolume delete /.snapshots/root-OLD
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞
sudo btrfs filesystem usage /

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
sudo btrfs scrub start /

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å scrub
sudo btrfs scrub status /

# –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É
sudo btrfs balance start /
```

### –°–∂–∞—Ç–∏–µ
–í—Å–µ —Ä–∞–∑–¥–µ–ª—ã —É–∂–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —Å –æ–ø—Ü–∏–µ–π `compress=zstd`. –ß—Ç–æ–±—ã –ø–µ—Ä–µ–∂–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã:
```bash
# –ù–∞–π—Ç–∏ –∏ –ø–µ—Ä–µ–∂–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo btrfs filesystem defragment -r -v -czstd /path/to/dir
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –î–µ–ª–∞–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–Ω–∞–ø—à–æ—Ç—ã –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ scrub –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Å–≤–æ–±–æ–¥–Ω—ã–º –º–µ—Å—Ç–æ–º (–º–∏–Ω–∏–º—É–º 10% –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–Ω–∞–ø—à–æ—Ç—ã —á–µ—Ä–µ–∑ snapper

## –õ–∞–π—Ñ—Ö–∞–∫–∏

- –ö–æ–º–º–∏—Ç—å –ø–æ—á–∞—â–µ, –±—Ä–∞—Ç–∞–Ω!
- –¢–µ—Å—Ç–∏—Ä—É–π –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ `nixos-rebuild test`
- –î–µ—Ä–∂–∏ –±—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥–∞ –≥–¥–µ-–Ω–∏–±—É–¥—å –≤ –æ–±–ª–∞–∫–µ
- –ü–µ—Ä–µ–¥ –±–æ–ª—å—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –¥–µ–ª–∞–π –±—Ä–∞–Ω—á
- –î–µ—Ä–∂–∏ –∫–æ–ø–∏—é —Ñ–ª–µ–π–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º —Å —Å–µ—Ç—å—é
- –ü—Ä–æ–≤–µ—Ä—è–π syntax —á–µ—Ä–µ–∑ `nix flake check`
- –ù–µ –∑–∞–±—ã–≤–∞–π –ø—Ä–æ `git push`!

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. –ï—Å–ª–∏ Hyprland –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç:
```bash
# –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏
journalctl -xe
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
systemctl status display-manager
```

2. –ü—Ä–æ–±–ª–µ–º—ã —Å–æ –∑–≤—É–∫–æ–º:
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º PipeWire
systemctl --user restart pipewire
```

3. GDM –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
systemctl status gdm
# –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏
journalctl -u gdm
```

4. –ü—Ä–æ–±–ª–µ–º—ã —Å WiFi:
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å NetworkManager
systemctl status NetworkManager
# –†–µ—Å—Ç–∞—Ä—Ç–∏–º –µ—Å–ª–∏ –Ω–∞–¥–æ
sudo systemctl restart NetworkManager
# –°–º–æ—Ç—Ä–∏–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ç–∏
nmcli device wifi list
```

5. –ü—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–Ω–∞–ø—à–æ—Ç–∞–º–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å snapper
systemctl status snapper-timeline.timer
systemctl status snapper-cleanup.timer

# –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ —Å–Ω–∞–ø—à–æ—Ç–æ–≤
journalctl -u snapper-timeline
```
